---
- hosts: test
  become: yes
  # vars_file:
  #   -vars.yaml

  pre_tasks: 
  - name: Update Apt Cache
    apt: 
      update_cache: true
      cache_valid_time: 3600
  
  handlers: 
  - name: restart plex
    service: 
      name: plexmediaserver
      state: restarted
  
  tasks: 
    - name: Get Plex deb package
      get_url: 
        url: https://downloads.plex.tv/plex-media-server-new/1.42.2.10156-f737b826c/debian/plexmediaserver_1.42.2.10156-f737b826c_amd64.deb?_gl=1*1gp45gg*_gcl_au*MTk1NDM2MTIwOS4xNzY0NDgwNDU2*_ga*NzYyMjg5NTIwLjE3NjM4MTMyMjU.*_ga_G6FQWNSENB*czE3NjQ0ODA0NTYkbzEkZzEkdDE3NjQ0ODA1NzgkajUyJGwwJGgw
        dest: ~/
    
    - name: Install the Plex Deb Package
      apt: 
        deb: ~/plexmediaserver_1.42.2.10156-f737b826c_amd64.deb
    
    - name: Start Plex
      service: 
        name: plexmediaserver
        state: started
        enabled: yes

    
